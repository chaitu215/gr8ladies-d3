var w=200,h=200,r=h/2,color=d3.scale.ordinal().range(["#FF66CC","#66CCFF","#CCFF66"]),data,totalWomen,totalMen,totalNonBinary,totalEmployees,totalWomenInLeadership,totalMenInLeadership,totalNonBinaryInLeadership,totalInLeadership,femaleDevelopers,maleDevelopers,nonBinaryDevelopers,femaleQA,maleQa,nonBinaryQA,totals,leadershipTotals,graphPieChart=function(a,b){var c=d3.select(a).append("svg:svg").data([b]).attr("width",w).attr("height",h).append("svg:g").attr("transform","translate("+r+","+r+")"),d=d3.layout.pie().value(function(a){return a.value}),e=d3.svg.arc().outerRadius(r),f=c.selectAll("g.slice").data(d).enter().append("svg:g").attr("class","slice");f.append("svg:path").attr("fill",function(a,b){return color(b)}).attr("d",function(a){return e(a)});var g=d3.select(a).append("svg").attr("class","legend").attr("width",2*r).attr("height",2*r).selectAll("g").data(color.domain().slice().reverse()).enter().append("g").attr("transform",function(a,c){return b[c].value>0?"translate(0,"+20*c+")":void 0});g.append("rect").attr("width",18).attr("height",18).style("fill",color),g.append("text").attr("x",24).attr("y",9).attr("dy",".35em").text(function(a,c){return b[a].value>0?b[a].label+"("+b[a].count+") -- "+b[a].value+"%":void 0})};d3.json("assets/data/data.json",function(a,b){totalWomen=_.sum(_.pluck(b,"totalWomen")),totalMen=_.sum(_.pluck(b,"totalMen")),totalNonBinary=_.sum(_.pluck(b,"totalNonBinary")),totalEmployees=totalWomen+totalMen+totalNonBinary,totalWomenInLeadership=_.sum(_.pluck(b,"leadershipWomen")),totalMenInLeadership=_.sum(_.pluck(b,"leadershipMen")),totalNonBinaryInLeadership=_.sum(_.pluck(b,"leadershipNonBinary")),totalInLeadership=totalMenInLeadership+totalWomenInLeadership+totalNonBinaryInLeadership,femaleDevelopers=_.sum(_.pluck(b,"developersWomen")),maleDevelopers=_.sum(_.pluck(b,"developersMen")),nonBinaryDevelopers=_.sum(_.pluck(b,"developersNonBinary")),totalDevelopers=maleDevelopers+femaleDevelopers+nonBinaryDevelopers,femaleQA=_.sum(_.pluck(b,"qaWomen")),maleQA=_.sum(_.pluck(b,"qaMen")),nonBinaryQA=_.sum(_.pluck(b,"nonBinaryQA")),totalQA=maleQA+femaleQA+nonBinaryQA,totals=[{label:"Women",value:Math.round(totalWomen/totalEmployees*100*10)/10,count:totalWomen},{label:"Men",value:Math.round(totalMen/totalEmployees*100*10)/10,count:totalMen},{label:"Non-binary Gender Identity",value:Math.round(totalNonBinary/totalEmployees*100*10)/10,count:totalNonBinary}],leadershipTotals=[{label:"Women",value:Math.round(totalWomenInLeadership/totalInLeadership*100*10)/10,count:totalWomenInLeadership},{label:"Men",value:Math.round(totalMenInLeadership/totalInLeadership*100*10)/10,count:totalMenInLeadership},{label:"Non-binary Gender Identity",value:Math.round(totalNonBinaryInLeadership/totalInLeadership*100*10)/10,count:totalNonBinaryInLeadership}],developerTotals=[{label:"Women",value:Math.round(femaleDevelopers/totalDevelopers*100*10)/10,count:femaleDevelopers},{label:"Men",value:Math.round(maleDevelopers/totalDevelopers*100*10)/10,count:maleDevelopers},{label:"Non-binary Gender Identity",value:Math.round(nonBinaryDevelopers/totalDevelopers*100*10)/10,count:nonBinaryDevelopers}],qaTotals=[{label:"Women",value:Math.round(femaleQA/totalQA*100*10)/10,count:femaleQA},{label:"Men",value:Math.round(maleQA/totalQA*100*10)/10,count:maleQA},{label:"Non-binary Gender Identity",value:Math.round(nonBinaryQA/totalQA*100*10)/10,count:nonBinaryQA}],graphPieChart("#pieChartTotals",totals),graphPieChart("#pieChartLeadership",leadershipTotals),graphPieChart("#pieChartDevelopers",developerTotals),graphPieChart("#pieChartQA",qaTotals)});